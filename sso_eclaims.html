<!DOCTYPE HTML>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-signin-client_id"
    content="1057443436801-mekai6m3evfnqs35fbmn9gcfkd3fj5pv.apps.googleusercontent.com">
  <title>Travel e-claims</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="css/tabs.css" rel="stylesheet" type="text/css" />
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <link href='css/css-fonts.css' rel='stylesheet'>
  <link rel="stylesheet" href="css/font-awesome.min.css">


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="./css/style_w.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>

  <script src="js/lib/jquery-1.11.1.min.js"></script>
  <script src="js/lib/jquery.validate.min.js"></script>
  <script src="js/lib/additional-methods.min.js"></script>
  <script src="js/lib/util.js"></script>
  <script src="js/lib/const.js"></script>
  <script src="js/controllers/feedbackController.js"></script>
  <script src="js/controllers/commonController.js"></script>
  
</head>

<body>

  <script type="text/javascript">
    $(function () {
      var urlParams = new URLSearchParams(window.location.search);
      let userData = {
        id: urlParams.get('_id'),
        isActive: true,
        email: urlParams.get('email'),
        firstName: urlParams.get('firstName'),
        lastName: urlParams.get('lastName'),
        phoneNumber: urlParams.get('phoneNumber')
      }
      // let userData=JSON.s({id:"6141f763eb58bb48e15e96fd",isActive:true,email:"rdas.extern@europ-assistance.in",firstName:"rakesh",lastName:"rakesh test",phoneNumber:"9963813259"})
      clearStore();
      $.ajax({
        async: true,
        crossDomain: true,
        url: env.node_api_url + "batchJobs/insuranceProviders/getByUUID?uuid=" + urlParams.get('uuid'),
        type: "GET",
        success: function (data) {
          // console.log('Client', data);
          var clientId = data[0].clientName
          setToStore("prefix", data[0].prefix);
          setToStore("clientIDNM", clientId);
          setToStore("clientID", data[0].clientId);

        },
        error: function (err) {
          console.log(err);
          alert("Error Occure , Please contact adminstrator");
        },
      });
      $.ajax({
        type: "POST",
        url: `${env.node_api_url}auth/ssoEclaimsLogin`,
        cache: false,
        data: userData,
        success: function (res) {
          //alert(JSON.stringify(res))
          let response = res;
          var user = {};
          if(urlParams.get('clientIDE')!=='RELIANCE'){
          user.firstName = response.firstName;
          user.lastName = response.lastName;
          user.email = response.email;
          user.mobile = response.mobile;
          user.clientId = urlParams.get('clientIDE');
          user.dob = response.dob ? response.dob : "";
          user.gender = response.gender ? response.gender : "";
          }
          if(urlParams.get('clientIDE')==='RELIANCE'){
            user.clientId = urlParams.get('clientIDE');
          }
          setToStore("clientHash", urlParams.get('uuid'));
          setToStore("user", JSON.stringify(user));
          setToStore("eclaimsToken", response.eclaimToken);
          setToStore("googleLogin", 0);
          setToStore("otpVerified", true);
          // setToStore("token", response.access_token);
          setToStore("token", response.eclaimToken);
          console.log(response);
          window.location = "https://eclaimsuat.europassistance.in/index.html" ;
        },
        error: function () {
          alert("Error");
        },
      });
    });
  </script>

  <div class="main">
    <!--Header-start-->
    <div class='body'>
      <span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </span>
      <div class='base'>
        <span></span>
        <div class='face'></div>
      </div>
    </div>
    <div class='longfazers'>
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
    <h1>Redirecting</h1>
    <!-- partial -->
    <script src="./script.js"></script>

  </div>
  <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
</body>

</html>
<script>
  function myFunction() {

  }
</script>